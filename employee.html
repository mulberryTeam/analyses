<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
  <title>لوحة الموظف - نظام إدارة الأعمال</title>
  <!-- رابط خطوط Google -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700" rel="stylesheet">
  <!-- أيقونات Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage-compat.js"></script>
  <!-- إضافة مكتبة Firestore -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
  <style>
    /* خلفية الفيديو */
    #bgVideo {
      position: fixed;
      right: 0;
      bottom: 0;
      min-width: 100%;
      min-height: 100%;
      z-index: -1;
      object-fit: cover;
    }
    /* قواعد عامة */
    body {
      font-family: 'Roboto', sans-serif;
      background: transparent;
      margin: 0;
      padding: 20px;
      transition: background 0.3s ease;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .header-left {
      display: flex;
      align-items: center;
    }
    .header-logo {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      margin-left: 10px;
    }
    .logout-btn {
      padding: 8px 16px;
      background: #e74c3c;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
      transition: transform 0.3s ease, background 0.3s ease;
    }
    .logout-btn:hover { 
      background: #c0392b;
      transform: scale(1.05);
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255,255,255,0.95);
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      position: relative;
      overflow: hidden;
    }
    /* قائمة الألسنة */
    .tab-nav {
      display: flex;
      border-bottom: 2px solid #ddd;
      margin-bottom: 20px;
      overflow-x: auto;
    }
    .tab-nav button {
      flex: 1;
      padding: 12px;
      background: none;
      border: none;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s ease, color 0.3s ease;
    }
    .tab-nav button:hover { background: #f0f0f0; }
    .tab-nav button.active {
      border-bottom: 3px solid #3498db;
      font-weight: bold;
    }
    /* زر الترجمة بلون مميز */
    #langToggleTab {
      background: #f39c12;
      color: #fff;
      border-radius: 4px;
    }
    #langToggleTab:hover {
      background: #e67e22;
    }
    /* واجهة التحليلات - فلتر المبيعات */
    .filter-section {
      margin-bottom: 20px;
      padding: 20px;
      background: #f0f4f8;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      transition: box-shadow 0.3s ease;
    }
    .filter-section:hover {
      box-shadow: 0 6px 14px rgba(0,0,0,0.15);
    }
    .filter-section label {
      margin-right: 10px;
      font-weight: 500;
    }
    .filter-section input {
      margin-right: 10px;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 4px;
      transition: border 0.3s ease;
    }
    .filter-section input:focus {
      border-color: #3498db;
      outline: none;
    }
    .filter-section button {
      padding: 8px 16px;
      background: #3498db;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.3s ease;
    }
    .filter-section button:hover { 
      background: #2980b9;
      transform: scale(1.03);
    }
    /* بطاقة المبيعات */
    .sales-card {
      background: #f7f9fc;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      overflow-x: auto;
      transition: box-shadow 0.3s ease;
    }
    .sales-card:hover {
      box-shadow: 0 6px 14px rgba(0,0,0,0.15);
    }
    .sales-card table {
      width: 100%;
      border-collapse: collapse;
    }
    .sales-card th, .sales-card td {
      padding: 12px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    .sales-card th { 
      background: #3498db; 
      color: #fff;
      font-weight: bold;
    }
    .sales-summary {
      margin-top: 15px;
      font-size: 16px;
      font-weight: bold;
    }
    /* واجهة الإعدادات */
    .account-settings {
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      transition: box-shadow 0.3s ease;
    }
    .account-settings:hover {
      box-shadow: 0 6px 14px rgba(0,0,0,0.15);
    }
    .account-settings h3 { margin-top: 0; }
    .account-settings label { display: block; margin-top: 10px; font-weight: 500; }
    .account-settings input[type="text"],
    .account-settings input[type="password"],
    .account-settings input[type="file"] {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      transition: border 0.3s ease;
    }
    .account-settings input:focus {
      border-color: #3498db;
      outline: none;
    }
    .account-settings button {
      margin-top: 15px;
      padding: 10px 20px;
      background: #3498db;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.3s ease;
    }
    .account-settings button:hover { 
      background: #2980b9;
      transform: scale(1.03);
    }
    /* استجابة لجميع الأجهزة */
    @media (max-width: 768px) {
      .container { padding: 20px; }
      .header { flex-direction: column; align-items: flex-start; }
      .logout-btn { width: 100%; text-align: center; }
      .tab-nav button { font-size: 14px; }
    }

.workplan-instructions p {
  font-weight: bold;
  font-family: 'Roboto', sans-serif;
  font-size: 16px;
  margin-bottom: 15px;
}


/* إزالة نقاط القائمة وحذف المسافات الافتراضية */
#productList {
  list-style: none;
  padding: 0;
  margin: 0;
}

/* صندوق الفئة اليومية */
#productList li {
  display: inline-block;
  padding: 10px 20px;
  margin-top: 10px;
  border: 2px solid #8e44ad;       /* إطار بنفسجي */
  border-radius: 8px;
  background-color: #f8e5fa;        /* خلفية فاتحة بنفسجية خفيفة */
  font-weight: bold;
  font-size: 18px;
  color: #8e44ad;                   /* نص بنفسجي */
}


/* 1. نخلي المربع ثابت أسفل الشاشة */
.motivational-container {
  background-color: #f8e5fa;
  border: 2px solid #8e44ad;
  border-radius: 8px;
  padding: 15px;
  margin-top: 0px;        /* مسافة بينه وبين اسم الفئة */
  margin-bottom: 0px;     /* مسافة من أسفل البطاقة */
}





/* 3. شكل النص داخل المربع */
.motivational-header {
  display: flex;
  align-items: center;
  font-weight: bold;
  font-size: 20px;
  margin-bottom: 10px;
}

.motivational-header .emoji {
  margin-left: 8px;
}

.motivational-text p {
  font-weight: bold;
  margin: 5px 0;
}





/* 3) زيادة المسافة بين اسم الفئة والمربع */
#productList {
  list-style: none;
  padding: 0;
  margin: 0;
  margin-bottom: 100px; /* ⬅️ المسافة بين الفئة والمربع التحفيزي */
}




  </style>
</head>
<body>
  <!-- خلفية الفيديو -->
  <video autoplay muted loop id="bgVideo">
    <source src="https://cdn.dribbble.com/userupload/28774288/file/large-0f5d92145d706df70e061ebbf838fa27.mp4" type="video/mp4">
    متصفحك لا يدعم تشغيل الفيديو.
  </video>
  
  <div class="header">
    <div class="header-left">
      <img class="header-logo" id="employeePhotoDisplay"
     src="https://cdn-icons-png.flaticon.com/512/8053/8053444.png"
     alt="صورة الموظف">

      <h1 id="employeeNameDisplay">لوحة الموظف</h1>
    </div>
    <button class="logout-btn" onclick="logout()">تسجيل الخروج</button>
  </div>
  <div class="container">
    <!-- قائمة الألسنة مع زر الترجمة -->
    <div class="tab-nav">
      <button id="tabAnalyticsBtn" class="active" onclick="showEmployeeTab('analytics', event)">تحليلات</button>
      <!-- تم حذف قسم المحادثة -->
   <button id="tabWorkPlanBtn" onclick="showEmployeeTab('workplan', event)">خطة العمل</button>

      <button id="tabSettingsBtn" onclick="showEmployeeTab('settings', event)">الإعدادات</button>
      <button id="langToggleTab" onclick="toggleLanguage()"><i class="fas fa-language"></i></button>
    </div>
    
    <!-- واجهة التحليلات -->
    <div id="analytics" class="employee-tab" style="display: block;">
      <div class="filter-section">
        <span id="filterLabel">تصفية المبيعات حسب:</span>
        <label id="radioDayLabel">
          <input type="radio" name="filterType" value="day" checked onclick="toggleFilterInputs('day')"> يوم
        </label>
        <label id="radioMonthLabel">
          <input type="radio" name="filterType" value="month" onclick="toggleFilterInputs('month')"> شهر
        </label>
        <label id="radioPeriodLabel">
          <input type="radio" name="filterType" value="period" onclick="toggleFilterInputs('period')"> فترة مخصصة
        </label>
        <div id="filterDay" style="margin-top:10px;">
          <input type="date" id="filterDayInput">
        </div>
        <div id="filterMonth" style="margin-top:10px; display:none;">
          <input type="month" id="filterMonthInput">
        </div>
        <div id="filterPeriod" style="margin-top:10px; display:none;">
          <label>من:</label>
          <input type="date" id="filterStartDate">
          <label>إلى:</label>
          <input type="date" id="filterEndDate">
        </div>
        <button onclick="loadSalesData()">تطبيق التصفية</button>
      </div>
      <h2 id="salesHeader">بيانات المبيعات والأرباح الخاصة بك</h2>
<h3 id="employeeTargetDisplay" style="color:#27ae60; margin-bottom: 15px;"></h3>

      <div id="salesData" class="sales-card">
        <!-- يتم تحميل جدول المبيعات هنا -->
      </div>
      <div class="sales-summary" id="salesSummary"></div>
    </div>
    
 <!-- واجهة خطة العمل -->
 <div id="workplan" class="employee-tab" style="display: none;">
   <div class="workplan-section">
     <h3>خطة العمل اليومية</h3>
     <div id="genderPrompt">
       <p>هل أنت ذكر أم أنثى؟</p>
       <button onclick="setGender('male')">ذكر</button>
       <button onclick="setGender('female')">أنثى</button>
     </div>
     <div id="planContent" style="display: none;">

<!-- بداية المربع التحفيزي -->
<div class="motivational-container">
  <p class="motivational-header">
    <strong>من القلب للقلب</strong>
    <span class="emoji">❤️</span>
  </p>
  <div class="motivational-text">
    <p><strong>هالدرب ما بيطلب جري، بيطلب استمرار</strong></p>
    <p><strong>“شوية شوية” تمشي خطوة بخطوة، وبالراحة تكسب الخبرة.</strong></p>
    <p><strong>كل يوم خذ فكرة صغيرة، جرّبها وانشرها، وبكرة ضبّط أفكار جديدة.</strong></p>
    <p><strong>حتى لو وقعت، قوم وضحك: “قطرة قطرة بتحف الصخر”.</strong></p>
    <p><strong>المهم تظل تبعثر طاقة وإصرار، والصبر مرة ولحظته حلوة.</strong></p>
    <p><strong>امشي يوم ورا يوم، وبابتسامة خفيفة، رح تلحق نجاح كبير!</strong></p>
  </div>
</div>
<!-- نهاية المربع التحفيزي -->


  <div id="planInstructions" class="workplan-instructions">
    <p><strong>شرح تقسيم الوقت:</strong> اختر يومًا في الأسبوع أو ساعة في اليوم لتحضير المحتوى للنشر، ووزّع وقتك بحيث تخصص كل يوم/ساعة لفئة منتج مختلفة.</p>
  </div>
  <h4>الفئة الموصى بها لهذا اليوم:</h4>
  <ul id="productList"></ul>
</div>

   </div>
 </div>


    <!-- واجهة الإعدادات -->
    <div id="settings" class="employee-tab" style="display: none;">
      <div class="account-settings">
        <h3 id="settingsHeader">إعدادات الحساب</h3>
        <label id="usernameLabel" for="accUsername">تغيير اسم المستخدم:</label>
        <input type="text" id="accUsername" placeholder="اسم المستخدم الجديد" oninput="this.value = this.value.toLowerCase()">
        <label id="passwordLabel" for="accPassword">تغيير كلمة المرور:</label>
        <input type="password" id="accPassword" placeholder="كلمة المرور الجديدة">
        
        <button id="updateSettingsBtn" onclick="updateAccountSettings()">تحديث الإعدادات</button>
      </div>
    </div>
  </div>
  
  <script>
    // إعدادات Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAi3_y7ugKB0cgzMV1-IVvbE2BwG_9RKSs",
      authDomain: "team-analysis-3c196.firebaseapp.com",
      databaseURL: "https://team-analysis-3c196-default-rtdb.firebaseio.com",
      projectId: "team-analysis-3c196",
      storageBucket: "team-analysis-3c196.firebasestorage.app",
      messagingSenderId: "38968485922",
      appId: "1:38968485922:web:667832a4aa77599ba8a6fb",
      measurementId: "G-853WkH2JK7"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    // تهيئة Firestore
    const firestore = firebase.firestore();

    // إعداد الترجمة
    let currentLanguage = 'ar';
    const translations = {
      ar: {
        employeeDashboard: "لوحة الموظف",
        welcome: "أهلاً, ",
        logout: "تسجيل الخروج",
        tabAnalytics: "تحليلات",
        tabSettings: "الإعدادات",
        filterLabel: "تصفية المبيعات حسب:",
        radioDay: "يوم",
        radioMonth: "شهر",
        radioPeriod: "فترة مخصصة",
        salesHeader: "بيانات المبيعات والأرباح الخاصة بك",
        tableHeaders: {
          product: "المنتج",
          sale: "سعر البيع (₪)",
          date: "التاريخ"
        },
        salesSummary: (totalSales, totalProfit) => `إجمالي المبيعات: ${totalSales} | إجمالي الأرباح: ₪${totalProfit}`,
        settingsHeader: "إعدادات الحساب",
        changeUsername: "تغيير اسم المستخدم:",
        changePassword: "تغيير كلمة المرور:",
        changePhoto: "تغيير الصورة الشخصية:",
        updateSettings: "تحديث الإعدادات",
        langToggle: "",
        chatInputPlaceholder: "اكتب رسالتك..."
      },
      en: {
        employeeDashboard: "Employee Dashboard",
        welcome: "Welcome, ",
        logout: "Logout",
        tabAnalytics: "Analytics",
        tabSettings: "Settings",
        filterLabel: "Filter Sales By:",
        radioDay: "Day",
        radioMonth: "Month",
        radioPeriod: "Custom Period",
        salesHeader: "Your Sales & Profit Data",
        tableHeaders: {
          product: "Product",
          sale: "Sale Price (₪)",
          date: "Date"
        },
        salesSummary: (totalSales, totalProfit) => `Total Sales: ${totalSales} | Total Profit: ₪${totalProfit}`,
        settingsHeader: "Account Settings",
        changeUsername: "Change Username:",
        changePassword: "Change Password:",
        changePhoto: "Change Personal Photo:",
        updateSettings: "Update Settings",
        langToggle: "",
        chatInputPlaceholder: "Type your message..."
      }
    };

    // استرجاع اسم الموظف المخزن في localStorage
    const employeeName = localStorage.getItem('employeeName');
    if (!employeeName) {
      alert("لم يتم العثور على جلسة الموظف. الرجاء تسجيل الدخول مرة أخرى.");
      window.location.href = "index.html";
    }
    document.getElementById('employeeNameDisplay').textContent = translations[currentLanguage].welcome + employeeName;
database.ref('employees').orderByChild('name').equalTo(employeeName).once('value')
  .then(snapshot => {
    snapshot.forEach(child => {
      const data = child.val();
      const points = data.target || 0;
      document.getElementById('employeeTargetDisplay').textContent = `عدد النقاط الحالية: ${points} نقطة`;
    });
  });


    // تحديث النصوص الثابتة للواجهة بناءً على اللغة الحالية
    function updateStaticTexts() {
      document.getElementById('employeeNameDisplay').textContent = translations[currentLanguage].welcome + employeeName;
      document.querySelector('.logout-btn').textContent = translations[currentLanguage].logout;
      document.getElementById('tabAnalyticsBtn').textContent = translations[currentLanguage].tabAnalytics;
      document.getElementById('tabSettingsBtn').textContent = translations[currentLanguage].tabSettings;
      document.getElementById('filterLabel').textContent = translations[currentLanguage].filterLabel;
      document.getElementById('radioDayLabel').innerHTML = `<input type="radio" name="filterType" value="day" checked onclick="toggleFilterInputs('day')"> ${translations[currentLanguage].radioDay}`;
      document.getElementById('radioMonthLabel').innerHTML = `<input type="radio" name="filterType" value="month" onclick="toggleFilterInputs('month')"> ${translations[currentLanguage].radioMonth}`;
      document.getElementById('radioPeriodLabel').innerHTML = `<input type="radio" name="filterType" value="period" onclick="toggleFilterInputs('period')"> ${translations[currentLanguage].radioPeriod}`;
      document.getElementById('salesHeader').textContent = translations[currentLanguage].salesHeader;
      document.getElementById('settingsHeader').textContent = translations[currentLanguage].settingsHeader;
      document.getElementById('usernameLabel').textContent = translations[currentLanguage].changeUsername;
      document.getElementById('passwordLabel').textContent = translations[currentLanguage].changePassword;
      
      document.getElementById('updateSettingsBtn').textContent = translations[currentLanguage].updateSettings;
    }
    updateStaticTexts();

    // استرجاع تعيينات البائع المميز
    let topSellerDesignations = {};
    database.ref('topSellerDesignations').on('value', snapshot => {
      topSellerDesignations = snapshot.val() || {};
    });

    // دالة المساعدة للحصول على نسبة البائع المميز
    function getTopSellerRate(empName, saleDate) {
      let rate = 0.5; // القيمة الافتراضية للموظف العادي
      for (const key in topSellerDesignations) {
        const des = topSellerDesignations[key];
        if (des.employee === empName) {
          const start = new Date(des.startDate);
          const end = new Date(des.endDate);
          const saleDt = new Date(saleDate);
          if (saleDt >= start && saleDt <= end) {
            rate = 0.6;
            break;
          }
        }
      }
      return rate;
    }

    // تحميل بيانات المبيعات مع حساب الأرباح (تم حذف عمود السعر الأصلي)
    function loadSalesData() {
      // الحصول أولاً على نوع الموظف من Realtime Database
      database.ref('employees').orderByChild('name').equalTo(employeeName).once('value')
      .then(empSnapshot => {
        let employeeType = "regular";
        empSnapshot.forEach(child => { employeeType = child.val().type; });
        // جلب بيانات المبيعات الخاصة بالموظف
        database.ref('sales').orderByChild('seller').equalTo(employeeName).once('value')
        .then(snapshot => {
          const salesData = snapshot.val() || {};
          let totalSales = 0;
          let totalProfit = 0;
          // إنشاء الجدول بدون عمود السعر الأصلي
          let tableHTML = `<table><tr>
            <th>${translations[currentLanguage].tableHeaders.product}</th>
            <th>${translations[currentLanguage].tableHeaders.sale}</th>
            <th>${translations[currentLanguage].tableHeaders.date}</th>
            </tr>`;
          const filterType = document.querySelector('input[name="filterType"]:checked').value;
let filterFn = sale => true;

// ✅ فلترة افتراضية: عرض الشهر الحالي إذا ما تم اختيار أي تواريخ
if (!document.getElementById('filterDayInput').value &&
    !document.getElementById('filterMonthInput').value &&
    !document.getElementById('filterStartDate').value &&
    !document.getElementById('filterEndDate').value) {
  const today = new Date();
  const year = today.getFullYear();
  const month = (today.getMonth() + 1).toString().padStart(2, '0');
  const currentMonth = `${year}-${month}`;
  filterFn = sale => sale.date.startsWith(currentMonth);
}


          if (filterType === "day") {
            const day = document.getElementById('filterDayInput').value;
            if (day) { filterFn = sale => sale.date.slice(0,10) === day; }
          } else if (filterType === "month") {
            const month = document.getElementById('filterMonthInput').value;
            if (month) { filterFn = sale => sale.date.startsWith(month); }
          } else if (filterType === "period") {
            const start = new Date(document.getElementById('filterStartDate').value);
            const end = new Date(document.getElementById('filterEndDate').value);
            if(document.getElementById('filterStartDate').value && document.getElementById('filterEndDate').value) {
              filterFn = sale => {
                const saleDate = new Date(sale.date);
                return saleDate >= start && saleDate <= end;
              };
            }
          }
          for (const key in salesData) {
            const sale = salesData[key];
            if (!filterFn(sale)) continue;
            totalSales++;
            const rawProfit = parseFloat(sale.salePrice) - parseFloat(sale.originalPrice);
            let percentage = 0.5; // القيمة الافتراضية
            if (employeeType === "distinguished") {
              percentage = 0.7;
            } else if (employeeType === "regular") {
              percentage = getTopSellerRate(employeeName, sale.date);
            }
            totalProfit += rawProfit * percentage;
            tableHTML += `<tr>
              <td>${sale.productName}</td>
              <td>₪${sale.salePrice}</td>
              <td>${new Date(sale.date).toLocaleDateString()}</td>
              </tr>`;
          }
          tableHTML += "</table>";
          document.getElementById('salesData').innerHTML = tableHTML;
          document.getElementById('salesSummary').innerHTML = `<p>${translations[currentLanguage].salesSummary(totalSales, totalProfit.toFixed(2))}</p>`;
        });
      });
    }
    loadSalesData();

    // تبديل عرض مدخلات الفلترة
    function toggleFilterInputs(type) {
      document.getElementById('filterDay').style.display = (type === 'day') ? 'block' : 'none';
      document.getElementById('filterMonth').style.display = (type === 'month') ? 'block' : 'none';
      document.getElementById('filterPeriod').style.display = (type === 'period') ? 'block' : 'none';
    }

 

    /* ------------------ واجهة الإعدادات ------------------ */
    function updateAccountSettings() {
      const newUsername = document.getElementById('accUsername').value.trim();
      const newPassword = document.getElementById('accPassword').value.trim();
      const fileInput = document.getElementById('accPhoto');
      let updates = {};
      if(newUsername) { updates.username = newUsername; }
      if(newPassword) { updates.password = newPassword; }
      
      // إذا تم اختيار صورة جديدة
      if (fileInput.files.length > 0) {
        let updates = {};
if (newUsername) { updates.username = newUsername; }
if (newPassword) { updates.password = newPassword; }

firestore.collection("employees").doc(employeeName)
  .set(updates, { merge: true })
  .then(() => {
    alert("تم تحديث إعدادات الحساب.");
  })
  .catch(error => {
    console.error("Error updating Firestore:", error);
    alert("حدث خطأ أثناء تحديث الإعدادات.");
  });

      }
    }

    /* ------------------ تغيير الألسنة ------------------ */
    function showEmployeeTab(tabName, event) {
      document.querySelectorAll('.employee-tab').forEach(tab => tab.style.display = 'none');
      document.querySelectorAll('.tab-nav button').forEach(btn => btn.classList.remove('active'));
      event.currentTarget.classList.add('active');
      document.getElementById(tabName).style.display = 'block';
    }

    /* ------------------ تبديل اللغة ------------------ */
    function toggleLanguage() {
      currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
      updateStaticTexts();
      loadSalesData();
    }

    /* ------------------ تسجيل الخروج ------------------ */
    function logout() {
      localStorage.clear();
      window.location.href = "index.html";
    }

// ====== بيانات فئات خطة العمل ======
const workPlanCategories = {
  male: [
    "معالجات وسيروم للوجه","مرطبات وكريمات للوجه","البشرة والوجه",
    "منتجات الحلاقة للرجال","منتجات العناية للرجال","مزيلات عرق للرجال",
    "عطور","عطور للرجال","تصفيف الشعر","غسولات","سيروم وزيوت للشعر",
    "شامبو","العناية بالشعر","الوقاية من الشمس والتسمير","العناية بالأسنان",
    "العناية بالفم"
  ],
  female: [
    "العناية بالجسم","مرطب للجسم","البشرة والوجه","مرطبات وكريمات للوجه",
    "معطر للجسم","مقشرات وملمعات الجسم","مستلزمات العناية الشخصية",
    "معالجات وسيروم للوجه","منتجات تقشير الجسم","تفتيح","عطور للنساء","عطور",
    "العناية بالقدم","النظافة الشخصية للنساء","صابون استحمام","العناية باليدين",
    "أقنعة الوجه","الوجه","الوقاية من الشمس والتسمير",
    "العناية بالأسنان","العناية بالفم","إزالة الشعر",
    "العناية بالحوامل والمرضعة","مزيلات عرق للنساء"
  ]
};


// ====== ١) إنشاء shuffle ثابت لكل موظف حسب اسمه وجنسه ======
function getEmployeeOrder(gender) {
  // ١. إحضار مصفوفة الفئات
  const cats = [...workPlanCategories[gender]];
  // ٢. بناء seed من اسم الموظف والجنس
  let seed = 0;
  for (let i = 0; i < employeeName.length; i++) {
    seed = (seed * 31 + employeeName.charCodeAt(i)) % 2147483647;
  }
  seed = (seed + (gender === 'male' ? 1 : 2)) % 2147483647;
  // ٣. LCG لتوليد أرقام عشوائية
  let rnd = seed;
  function next() {
    rnd = (rnd * 16807) % 2147483647;
    return (rnd - 1) / 2147483646;
  }
  // ٤. Fisher–Yates shuffle
  for (let i = cats.length - 1; i > 0; i--) {
    const j = Math.floor(next() * (i + 1));
    [cats[i], cats[j]] = [cats[j], cats[i]];
  }
  return cats;
}

// ====== ٢) اختيار الفئة لليوم الحالي من القائمة الكاملة ======
function getCategoryForToday(gender) {
  const order = getEmployeeOrder(gender);
  // حساب عدد الأيام منذ 1 يناير 1970
  const daysSinceEpoch = Math.floor(Date.now() / (1000 * 60 * 60 * 24));
  // الموضع في القائمة
  const idx = daysSinceEpoch % order.length;
  return order[idx];
}

// ====== ٣) عرض فئة اليوم فقط ======
function showPlan(gender) {
  const listEl = document.getElementById('productList');
  listEl.innerHTML = '';
  const todayCat = getCategoryForToday(gender);
  const li = document.createElement('li');
  li.textContent = todayCat;
  listEl.appendChild(li);
  document.getElementById('planContent').style.display = 'block';
}



// حفظ الجنس في Firestore وعرض الخطة
// ====== دالة setGender الجديدة باستخدام Realtime Database ======
function setGender(gender) {
  console.log("setGender called with:", gender);
  // إخفاء واجهة السؤال
  document.getElementById('genderPrompt').style.display = 'none';
  // عرض الخطة فوراً
  showPlan(gender);

  // تحديث فئة gender في الـRealtime Database
  database.ref('employees')
    .orderByChild('name')
    .equalTo(employeeName)
    .once('value')
    .then(snapshot => {
      snapshot.forEach(child => {
        // child.key هو الـ ID لكل موظف
        database.ref('employees/' + child.key)
          .update({ gender: gender })
          .then(() => console.log("Gender saved to Realtime DB"))
          .catch(err => console.error("Error saving gender:", err));
      });
    })
    .catch(err => console.error("Error querying employees:", err));
}





// عند الضغط على تبويب “خطة العمل” (Realtime DB)
document.getElementById('tabWorkPlanBtn').addEventListener('click', () => {
  database.ref('employees')
    .orderByChild('name')
    .equalTo(employeeName)
    .once('value')
    .then(snapshot => {
      let gender = null;
      snapshot.forEach(child => { gender = child.val().gender; });
      if (gender) {
        document.getElementById('genderPrompt').style.display = 'none';
        showPlan(gender);
      } else {
        document.getElementById('genderPrompt').style.display = 'block';
        document.getElementById('planContent').style.display = 'none';
      }
    })
    .catch(err => console.error("Error fetching gender:", err));
});



  </script>
</body>
</html>
